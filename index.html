<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DM1 Helper - Premium Edition</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
</head>

<body>
    <div class="app-shell">
        <!-- Dashboard View -->
        <section id="view-dashboard" class="view active">
            <header class="view-header">
                <div>
                    <h1 class="premium-title">Resumen <small style="font-size: 0.5em; opacity: 0.5;">v8.1</small></h1>
                    <p class="subtitle" id="last-update">Actualizado: --:--</p>
                </div>
                <div class="glucose-badge" id="main-glucose-badge">
                    <span id="display-glucose">--</span>
                    <span class="trend" id="display-trend"></span>
                </div>
            </header>

            <div class="chart-container glass">
                <canvas id="glucose-chart"></canvas>
            </div>

            <div class="quick-stats">
                <div class="stat-card glass">
                    <span class="stat-label">Insul. Activa</span>
                    <span class="stat-value">0.0 U</span>
                </div>
                <div class="stat-card glass">
                    <span class="stat-label">Carbs Hoy</span>
                    <span class="stat-value">-- g</span>
                </div>
            </div>
        </section>

        <!-- Add Food View -->
        <section id="view-add" class="view">
            <header class="view-header">
                <h1 class="premium-title">Nueva Comida</h1>
            </header>

            <div class="input-card glass">
                <textarea id="food-description" placeholder="¬øQu√© vas a comer? (Ej: 2 empanadas de carne)"></textarea>
                <div class="input-actions">
                    <button class="btn-secondary" id="camera-trigger">üì∏</button>
                    <input type="file" id="food-photo" accept="image/*" capture="environment" hidden>
                    <button class="btn-primary" id="analyze-btn">Analizar</button>
                </div>
            </div>

            <div id="results-panel" class="results-panel glass hidden">
                <div class="nutrients-summary">
                    <div class="nutrient">
                        <span class="label">Carbs</span>
                        <span id="res-carbs" class="value">0g</span>
                    </div>
                    <div class="nutrient">
                        <span class="label">IG</span>
                        <span id="res-gi" class="value">--</span>
                    </div>
                </div>

                <div class="correction-panel">
                    <label>Glucemia actual</label>
                    <input type="number" id="current-glucose" value="100">
                </div>

                <div class="dose-display">
                    <span class="dose-label">Dosis Sugerida</span>
                    <span id="suggested-dose" class="dose-value">0.0</span>
                    <span class="dose-unit">unidades</span>
                </div>

                <button class="btn-primary large" id="save-btn">Registrar Dosis</button>
            </div>
        </section>

        <!-- History View -->
        <section id="view-history" class="view">
            <header class="view-header">
                <h1 class="premium-title">Historial</h1>
            </header>
            <div class="history-container glass">
                <ul id="history-list">
                    <!-- Dynamic Items -->
                </ul>
            </div>
        </section>

        <!-- Settings View -->
        <section id="view-settings" class="view">
            <header class="view-header">
                <h1 class="premium-title">Ajustes</h1>
            </header>
            <div class="settings-container glass">
                <div class="config-group">
                    <label>Ratio Insulina/HC (ICR)</label>
                    <input type="number" id="cfg-icr" step="0.1">
                </div>
                <div class="config-group">
                    <label>Sensibilidad (ISF)</label>
                    <input type="number" id="cfg-isf" step="1">
                </div>
                <div class="config-group">
                    <label>Objetivo</label>
                    <input type="number" id="cfg-target" step="1">
                </div>
                <div class="config-group">
                    <label>API xDrip+</label>
                    <input type="text" id="cfg-xdrip" placeholder="http://localhost:17580">
                </div>
                <div class="config-group">
                    <label>Gemini API Key</label>
                    <input type="password" id="cfg-gemini" placeholder="Tu API Key de Gemini">
                    <small
                        style="color: var(--text-dim); font-size: 0.7rem; display: block; margin-top: 0.25rem;">Consigue
                        una gratis en <a href="https://aistudio.google.com/app/apikey" target="_blank"
                            style="color: var(--accent-blue);">AI Studio</a></small>
                </div>
                <button class="btn-primary" id="save-settings">Guardar Cambios</button>
                <div style="text-align: center; margin-top: 2rem; opacity: 0.5; font-size: 0.7rem;">
                    Versi√≥n Instalada: <span id="app-version">v8.0</span>
                </div>
            </div>
        </section>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-view="dashboard">
                <span class="icon">üè†</span>
                <span class="label">Inicio</span>
            </button>
            <button class="nav-item" data-view="add">
                <span class="icon">‚ûï</span>
                <span class="label">A√±adir</span>
            </button>
            <button class="nav-item" data-view="history">
                <span class="icon">üìú</span>
                <span class="label">Diario</span>
            </button>
            <button class="nav-item" data-view="settings">
                <span class="icon">‚öôÔ∏è</span>
                <span class="label">Ajustes</span>
            </button>
        </nav>
    </div>
    <script src="main_v8.js"></script>
</body>

</html>